<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>SparkPlay</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --nintendo-red: #E60012;
  --nintendo-blue: #00A0E9;
  --nintendo-yellow: #FFD200;
  --bg-deep: #050A1A;
  --text: #FFFFFF;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body { 
  margin: 0; 
  background-color: var(--bg-deep); 
  font-family: 'Quicksand', sans-serif; 
  color: var(--text); 
  height: 100vh;
  overflow: hidden;
  /* Sfondo stellato fisso su tutto il corpo */
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.15) 1px, transparent 1px),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,0.1) 1px, transparent 1px),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,0.2) 2px, transparent 2px);
  background-size: 100px 100px, 150px 150px, 200px 200px;
}

/* Rimosso il guscio (sp-shell): ora tutto fluttua nello spazio */
.sp-root { 
  max-width: 600px; 
  margin: 0 auto; 
  height: 100vh;
  display: flex;
  flex-direction: column;
  padding: 30px 20px;
  position: relative;
}

/* Header fluttuante */
.sp-top { 
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  margin-bottom: 40px;
}

.brand { 
  font-family: 'Fredoka One', cursive;
  font-size: 28px;
  color: var(--nintendo-yellow);
  text-shadow: 3px 3px 0px var(--nintendo-red);
  letter-spacing: 2px;
}

/* Blocchi di testo trasparenti e spaziosi */
.content-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 25px;
}

.story-text {
  font-size: 20px;
  line-height: 1.4;
  text-align: center;
  color: #CFD9FF;
}

.goal-box {
  background: rgba(0, 160, 233, 0.2);
  border: 4px solid var(--nintendo-blue);
  border-radius: 20px;
  padding: 15px;
  text-align: center;
  font-weight: 700;
  font-size: 22px;
}

/* Steps in stile "Level Select" */
.steps {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.step { 
  padding: 18px; 
  border-radius: 25px; 
  background: rgba(255, 255, 255, 0.05);
  border: 3px solid transparent;
  font-size: 18px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 15px;
}

.step.active { 
  background: white;
  color: var(--bg-deep);
  border-color: var(--nintendo-yellow);
  transform: scale(1.05);
  box-shadow: 0 0 20px var(--nintendo-yellow);
}

.step.dim { opacity: 0.2; }

.num {
  background: var(--nintendo-red);
  color: white;
  width: 35px; height: 35px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Fredoka One';
}

/* Bottoni stile Console */
.controls {
  display: flex;
  gap: 15px;
  margin-top: 30px;
}

.btn {
  flex: 1;
  border: none;
  border-radius: 50px;
  padding: 20px;
  font-family: 'Fredoka One', cursive;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 8px 0px rgba(0,0,0,0.3);
  transition: 0.1s;
}

.btn:active { transform: translateY(4px); box-shadow: 0 4px 0px rgba(0,0,0,0.3); }

.btn-a { background: var(--nintendo-red); color: white; }
.btn-b { background: #555; color: white; }

.orb { font-size: 80px; text-align: center; margin: 20px 0; }
</style>
</head>
<body>

<div id="SPARKPLAY_APP" class="sp-root"></div>

<script>
(()=>{"use strict";
const DB={
  small:[
    {title:"SEGNALE PERDUTO", badge:"ðŸ“¡", story:"La base ha perso il segnale! La galassia Ã¨ al buio!", goal:"RIACCENDI L'ANTENNA!", steps:["Trova un calzino (l'antenna).","Portalo sulla base (tappeto).","DÃ¬ 3 Bip! lentamente."], finale:"SEGNALE OK!"}
  ]
};

let state = { fsm:"WELCOME", step:0, quest:null };

function render(){
  const root = document.getElementById("SPARKPLAY_APP");
  
  if(state.fsm === "WELCOME"){
    root.innerHTML = `
      <div class="sp-top"><div class="brand">SPARKPLAY</div></div>
      <div class="content-area" style="text-align:center; justify-content:center;">
        <div class="orb">ðŸš€</div>
        <h1 style="font-family:'Fredoka One'; font-size:40px; color:var(--nintendo-yellow);">PRONTO?</h1>
        <button class="btn btn-a" onclick="start()">START MISSION</button>
      </div>`;
  } else {
    const q = state.quest;
    root.innerHTML = `
      <div class="sp-top">
        <div class="brand">MISSION</div>
        <button class="btn btn-b" style="padding:10px; border-radius:15px; flex:0;" onclick="home()">EXIT</button>
      </div>
      <div class="content-area">
        <div class="story-text">${q.story}</div>
        <div class="goal-box">${q.goal}</div>
        <div class="steps">
          ${q.steps.map((text, i) => `
            <div class="step ${i === state.step ? 'active' : (i < state.step ? '' : 'dim')}">
              <div class="num">${i + 1}</div> ${text}
            </div>
          `).join('')}
        </div>
        <div class="controls">
          <button class="btn btn-b" onclick="prev()" ${state.step===0?'style="opacity:0"':''}>BACK</button>
          <button class="btn btn-a" onclick="next()">NEXT</button>
        </div>
      </div>`;
  }
}

window.start = () => { state.fsm="QUEST"; state.quest=DB.small[0]; state.step=0; render(); };
window.home = () => { state.fsm="WELCOME"; render(); };
window.prev = () => { if(state.step>0) { state.step--; render(); } };
window.next = () => {
  if(state.step < state.quest.steps.length - 1) {
    state.step++; render();
  } else {
    alert("MISSIONE COMPIUTA! ðŸŒŸ");
    home();
  }
};
render();
})();
</script>
</body>
</html>
