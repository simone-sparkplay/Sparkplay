<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>SparkPlay</title>

  <!-- SparkPlay Montessori â€“ Single File Core -->
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --accent:#4f7cff;
      --gold:#ffb703;
      --text:#f1f5ff;
      --muted:#9aa6d6;
      --ok:#2dd4bf;
      --radius:22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, Inter, system-ui, sans-serif;
      background:linear-gradient(180deg,#060914,#0b1020);
      color:var(--text);
    }

    .app{
      max-width:420px;
      margin:0 auto;
      padding:16px;
      padding-bottom:calc(24px + env(safe-area-inset-bottom));
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 20px 40px rgba(0,0,0,.4);
      margin-bottom:14px;
    }

    h1,h2{
      margin:0 0 8px;
      font-weight:900;
      letter-spacing:.3px;
    }

    p{
      margin:0 0 12px;
      color:var(--muted);
      line-height:1.45;
      font-size:14px;
    }

    button{
      width:100%;
      border:0;
      border-radius:16px;
      padding:14px;
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      background:linear-gradient(135deg,var(--accent),#7a6cff);
      color:white;
    }

    button.secondary{
      background:#1a244a;
      color:var(--text);
    }

    button.gold{
      background:linear-gradient(135deg,var(--gold),#ff8800);
      color:#1b1400;
    }

    .row{display:flex;gap:10px}
    .row button{flex:1}

    .progress{
      height:10px;
      background:#1a244a;
      border-radius:999px;
      overflow:hidden;
      margin-top:10px;
    }

    .bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--accent),var(--gold));
    }

    .step{
      background:#0e1530;
      border-radius:14px;
      padding:14px;
      margin-bottom:10px;
      font-size:14px;
    }

    .diary-item{
      background:#0e1530;
      border-radius:14px;
      padding:12px;
      margin-bottom:8px;
      font-size:13px;
    }

    .center{text-align:center}
  </style>
</head>

<body>
<div class="app" id="app"></div>

<script>
/*
  SPARKPLAY â€“ CORE MONTESSORI
  Ritmo giornaliero:
  1) Esplora
  2) Crea
  3) Calma
  Dopo 3 â†’ STOP genitore
*/

const MISSIONS = [
  {
    phase:"Esplora",
    title:"Radar Spaziale",
    steps:[
      "Prendi una torcia o usa la luce della stanza.",
      "Trova 3 oggetti intorno a te.",
      "Descrivili come se fossi su un pianeta alieno."
    ]
  },
  {
    phase:"Crea",
    title:"Costruisci la Base",
    steps:[
      "Usa 3 oggetti di casa.",
      "Costruisci una base sul tavolo o sul pavimento.",
      "Spiega a cosa serve ogni parte."
    ]
  },
  {
    phase:"Calma",
    title:"Respiro dellâ€™Astronauta",
    steps:[
      "Siediti comodo.",
      "Conta lentamente da 5 a 1.",
      "Fai un respiro profondo a ogni numero."
    ]
  }
];

const KEY = "sparkplay_state_v1";

let state = JSON.parse(localStorage.getItem(KEY)) || {
  day:new Date().toDateString(),
  step:0,
  diary:[]
};

if(state.day !== new Date().toDateString()){
  state.step = 0;
  state.day = new Date().toDateString();
}

function save(){
  localStorage.setItem(KEY, JSON.stringify(state));
}

function render(){
  const app = document.getElementById("app");
  app.innerHTML = "";

  // BLOCCO GENITORE
  if(state.step >= 3){
    app.innerHTML = `
      <div class="card center">
        <h2>ðŸŒ™ Fine per oggi</h2>
        <p>SparkPlay si ferma qui.<br>
        Il gioco continua nel mondo reale.</p>
        <p><b>Consiglio per il genitore:</b><br>
        Lascia che il bambino racconti la missione fatta.</p>
      </div>
      <div class="card">
        <h2>ðŸ““ Diario</h2>
        ${state.diary.map(d=>`
          <div class="diary-item">
            <b>${d.phase}</b> â€“ ${d.title}
          </div>
        `).join("")}
      </div>
    `;
    return;
  }

  const mission = MISSIONS[state.step];

  app.innerHTML = `
    <div class="card">
      <h1>${mission.phase}</h1>
      <p>${mission.title}</p>

      <div class="progress">
        <div class="bar" style="width:${(state.step/3)*100}%"></div>
      </div>
    </div>

    <div class="card">
      ${mission.steps.map(s=>`
        <div class="step">${s}</div>
      `).join("")}
    </div>

    <div class="card">
      <button onclick="complete()">Missione completata</button>
    </div>
  `;
}

function complete(){
  const m = MISSIONS[state.step];
  state.diary.unshift({
    phase:m.phase,
    title:m.title
  });
  state.step++;
  save();
  render();
}

render();
</script>
</body>
</html>