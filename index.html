<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>SparkPlay</title>
<link rel="apple-touch-icon" href="icona.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
/* --- BASE GRAFICA PREMIUM --- */
:root{
  --bg0:#070B14; --bg1:#0B1220; --ink:#EAF2FF; --muted:#A9B7D6; --line:rgba(255,255,255,.10);
  --accent:#3F5EF6; --gold:#FFB300; --radius:26px; --shadow:0 30px 70px rgba(0,0,0,.45);
}
body{
  margin:0; min-height:100vh;
  background: radial-gradient(1200px 800px at 30% 10%, rgba(63,94,246,.22), transparent 60%), linear-gradient(180deg, var(--bg0), var(--bg1));
  font-family: Inter, system-ui, sans-serif; color:var(--ink);
}
.sp-root{ max-width:900px; margin:0 auto; padding:20px; }
.sp-shell{ border: 1px solid var(--line); border-radius:var(--radius); background:rgba(255,255,255,.02); box-shadow:var(--shadow); overflow:hidden;}
.sp-top{ padding:16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center; }
.brand{ font-weight:1000; letter-spacing:1px; font-size:18px; color:var(--gold); }
.card{ background:rgba(255,255,255,.05); border:1px solid var(--line); border-radius:22px; padding:20px; margin-bottom:15px; }
.btn{ border:none; border-radius:18px; padding:18px; font-weight:900; cursor:pointer; font-size:16px; transition:0.3s; }
.btn-primary{ background:linear-gradient(135deg, var(--accent), #5673FF); color:white; width:100%; }
.btn-ghost{ background:transparent; color:var(--ink); border:1px solid var(--line); }
.step{ padding:15px; border-radius:12px; margin-bottom:10px; background:rgba(0,0,0,0.2); border:1px solid transparent; }
.step.active{ border-color:var(--accent); background:rgba(63,94,246,0.1); }
.step.dim{ opacity:0.3; }

/* ===== UI CLEAN PATCH (A) ===== */
.center-spark{ position:relative; background:transparent !important; box-shadow:none !important; }
.center-spark .spark-dot{
  width:62px;height:62px;border-radius:50%;
  background:#fff;
  display:block;
  position:relative;
  z-index:2;
}
.center-spark .spark-glow{
  position:absolute;inset:-18px;
  border-radius:50%;
  background: radial-gradient(circle, rgba(255,230,109,.55) 0%, rgba(255,230,109,.15) 45%, transparent 70%);
  z-index:1;
}
.multiverso-wrap{
  width: 240px !important; height: 240px !important;
  margin: 0 auto 16px !important;
  position: relative; display:flex; align-items:center; justify-content:center;
}
.orbit-icon{
  left:50% !important; top:50% !important;
  width:44px; height:44px;
  display:flex; align-items:center; justify-content:center;
  transform: translate(-50%,-50%);
  animation: orbit 10s linear infinite;
  will-change: transform;
}
.orbit-svg{ width:44px; height:44px; fill: rgba(255,255,255,.92); stroke: rgba(255,255,255,.92); }
.orbit-svg path, .orbit-svg circle { vector-effect: non-scaling-stroke; }

@keyframes orbit{
  from{transform: translate(-50%,-50%) rotate(0deg) translateX(98px) rotate(0deg)}
  to{transform: translate(-50%,-50%) rotate(360deg) translateX(98px) rotate(-360deg)}
}
.btn-big{ box-shadow: 0 10px 24px rgba(0,0,0,.22) !important; border: 1px solid rgba(255,255,255,.10); }
.btn-big:active{ transform: scale(.99) !important; }
.glass-card{ background: rgba(255,255,255,.09) !important; border: 1px solid rgba(255,255,255,.12) !important; box-shadow: 0 14px 34px rgba(0,0,0,.34) !important; }
#screen-home h2{ letter-spacing: .5px; text-shadow: none !important; }
.chip{ background: rgba(0,0,0,.28) !important; border: 1px solid rgba(255,255,255,.10) !important; }
.diary-emoji{ background: rgba(255,255,255,.06) !important; border: 1px solid rgba(255,255,255,.10) !important; }
#main-container, .screen{ overflow: hidden !important; }
</style>
</head>
<body>
<div id="SPARKPLAY_APP" class="sp-root"></div>

<script>
(()=>{"use strict";

const DB = {
  small: [
    {id:"s01", title:"Segnale Perduto", story:"La base ha perso il segnale. La galassia resta al buio.", goal:"Riaccendi l‚Äôantenna.", prop:"un calzino", steps:["Trova l‚Äôantenna (calzino) e stringila forte.","Portala nella tua base e appoggiala in alto.","Fai 3 'bip' lenti."], finale:"Segnale tornato. Base salva!", q:"A chi manderesti il primo messaggio?"}
  ]
};

let state = { fsm:"WELCOME", audio:false, step:0, quest:null };

const AudioEng = {
  speak(text, onEnd) {
    if(!state.audio) { if(onEnd) onEnd(); return; }
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang="it-IT"; u.rate=0.88; 
    if(onEnd) u.onend = onEnd;
    speechSynthesis.speak(u);
  }
};

function render(){
  const root = document.getElementById("SPARKPLAY_APP");
  
  if(state.fsm === "WELCOME"){
    root.innerHTML = `
      <div class="sp-shell">
        <div class="sp-top"><div class="brand">SPARKPLAY üöÄ</div><button class="btn btn-ghost" onclick="toggleAudio()">${state.audio?'üîä':'üîà'}</button></div>
        <div style="padding:40px; text-align:center;">
          
          <div class="multiverso-wrap">
            <div class="center-spark">
              <span class="spark-dot"></span>
              <span class="spark-glow"></span>
            </div>
            <div class="orbit-icon o1" aria-hidden="true">
              <svg viewBox="0 0 24 24" class="orbit-svg"><path d="M14.8 2.3c3.8 2 6.1 6.2 5.9 10.5-.1 2.4-.9 4.6-2.2 6.4l-3.3-3.3c.7-1.1 1.1-2.3 1.2-3.6.1-2.9-1.4-5.7-3.9-7.1l2.3-2.9z"/><path d="M9.2 21.7c-3.8-2-6.1-6.2-5.9-10.5.1-2.4.9-4.6 2.2-6.4l3.3 3.3c-.7 1.1-1.1 2.3-1.2 3.6-.1 2.9 1.4 5.7 3.9 7.1l-2.3 2.9z"/><circle cx="12" cy="12" r="2.2"/></svg>
            </div>
            <div class="orbit-icon o2" aria-hidden="true">
              <svg viewBox="0 0 24 24" class="orbit-svg"><path d="M4 20l10-10 2 2L6 22H4v-2z"/><path d="M15.5 3l1 2.2L19 6l-2.2 1 1 2.2-2-1-2 1 1-2.2-2.2-1 2.2-.8 1-2.2z"/></svg>
            </div>
            <div class="orbit-icon o3" aria-hidden="true">
              <svg viewBox="0 0 24 24" class="orbit-svg"><circle cx="11" cy="11" r="6" fill="none" stroke-width="2"/><path d="M16 16l5 5" fill="none" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
          </div>

          <h2 style="margin-bottom:10px;">PRONTI?</h2>
          <p style="color:var(--muted); margin-bottom:25px;">La tua avventura inizia fuori dallo schermo.</p>
          <button class="btn btn-primary btn-big" onclick="startQuest()">AVVIA MISSIONE</button>
        </div>
      </div>`;
  }

  if(state.fsm === "QUEST"){
    const q = state.quest;
    root.innerHTML = `
      <div class="sp-shell">
        <div class="sp-top">
          <button class="btn btn-ghost" onclick="toggleAudio()">${state.audio?'üîä':'üîà'}</button>
          <div class="brand">MISSIONE</div>
          <button class="btn btn-ghost" onclick="goHome()">üè†</button>
        </div>
        <div style="padding:20px;">
          <div class="card glass-card"><b>Storia:</b> ${q.story}<br><br><b>Obiettivo:</b> ${q.goal}</div>
          <div class="card chip" style="margin-bottom:10px;">üéí Oggetto: <b>${q.prop}</b></div>
          <div>${q.steps.map((s,i)=>`<div class="step ${i===state.step?'active':'dim'}"><b>${i+1}.</b> ${s}</div>`).join("")}</div>
          <button class="btn btn-primary" onclick="handleNext()">${state.step < q.steps.length-1 ? 'PROSSIMO PASSO' : 'COMPLETATO ‚úÖ'}</button>
        </div>
      </div>`;
  }
}

window.toggleAudio = () => {
  state.audio = !state.audio;
  if(state.audio) AudioEng.speak("Audio attivato");
  else speechSynthesis.cancel();
  render();
};

window.startQuest = () => {
  state.fsm = "QUEST"; state.quest = DB.small[0]; state.step = 0; render();
  AudioEng.speak(state.quest.story + " Obiettivo: " + state.quest.goal + ". Passo 1: " + state.quest.steps[0]);
};

window.handleNext = () => {
  const q = state.quest;
  if(state.step < q.steps.length - 1) {
    state.step++; render();
    AudioEng.speak("Passo " + (state.step+1) + ". " + q.steps[state.step], () => {
      if(state.step === q.steps.length - 1) {
        setTimeout(() => AudioEng.speak("Gran Finale. " + q.finale + ". Curiosit√† Spaziale. " + q.q), 800);
      }
    });
  } else {
    AudioEng.speak("Missione completata. Complimenti.");
    alert("üåü MISSIONE COMPLETATA\n\nComplimenti!");
    goHome();
  }
};

window.goHome = () => { state.fsm = "WELCOME"; render(); };

render();
})();
</script>
</body>
</html>
