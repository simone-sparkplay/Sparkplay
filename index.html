<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>SparkPlay Multiverso</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --rossa: #ff5e6c; --blu: #00d2ff; --giallo: #ffe66d; --viola: #a66cff;
  --sfondo: #1a1a40; --latte: #f7fff7;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { 
  margin: 0; background-color: var(--sfondo); font-family: 'Quicksand', sans-serif; 
  color: var(--latte); height: 100vh; overflow: hidden;
  /* Gradiente pi√π caldo e magico */
  background: radial-gradient(circle at top right, #2d1b4e, #1a1a40 60%);
}

/* --- UI MULTIVERSO --- */
.multiverso-container {
  width: 220px; height: 220px; margin: 0 auto 20px; position: relative;
  display: flex; align-items: center; justify-content: center;
}
.icona-mondo { 
  position: absolute; font-size: 55px; 
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
  animation: orbitaMondi 10s linear infinite; 
}
.mondo-1 { animation-delay: 0s; color: var(--blu); }
.mondo-2 { animation-delay: -3.33s; color: var(--viola); }
.mondo-3 { animation-delay: -6.66s; color: var(--giallo); }

@keyframes orbitaMondi {
  from { transform: rotate(0deg) translateX(85px) rotate(0deg); }
  to { transform: rotate(360deg) translateX(85px) rotate(-360deg); }
}

.centro-spark { 
  width: 70px; height: 70px; background: white; border-radius: 50%;
  box-shadow: 0 0 40px var(--giallo), 0 0 10px white; 
  z-index: 5; display: flex; align-items: center; justify-content: center; font-size: 35px; 
}

.sp-root { max-width: 600px; margin: 0 auto; height: 100vh; display: flex; flex-direction: column; padding: env(safe-area-inset-top) 25px env(safe-area-inset-bottom); position: relative; }
.sp-top { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
.brand { font-family: 'Fredoka One', cursive; font-size: 34px; color: var(--giallo); text-shadow: 3px 3px var(--rossa); letter-spacing: 1px; }

.content-area { flex: 1; display: flex; flex-direction: column; gap: 15px; justify-content: center; }

/* Bottoni Selezione Mondo */
.card-mondo {
  background: rgba(255,255,255,0.08); border: 3px solid transparent;
  border-radius: 25px; padding: 20px; display: flex; align-items: center; gap: 15px;
  cursor: pointer; transition: 0.2s; text-align: left;
}
.card-mondo:active { transform: scale(0.97); }
.card-mondo.spazio { border-color: var(--blu); }
.card-mondo.magia { border-color: var(--viola); }
.card-mondo.detective { border-color: var(--giallo); }

.testo-storia { font-size: 19px; line-height: 1.4; text-align: center; margin-bottom: 10px; }
.obiettivo-box { border: 2px solid var(--blu); border-radius: 20px; padding: 12px; text-align: center; font-weight: 700; color: var(--blu); background: rgba(0,210,255,0.05); }

.passo { padding: 16px; border-radius: 22px; background: rgba(255, 255, 255, 0.06); display: flex; align-items: center; gap: 12px; font-weight: 700; transition: 0.3s; opacity: 0.5; }
.passo.attivo { background: var(--latte); color: var(--sfondo); transform: scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.3); opacity: 1; }

.btn-avanti { background: var(--rossa); border: none; color: white; padding: 20px; width: 100%; font-size: 20px; font-family: 'Fredoka One'; border-radius: 25px; box-shadow: 0 6px 0 #c43d4a; cursor: pointer; }
.btn-avanti:active { transform: translateY(4px); box-shadow: 0 2px 0 #c43d4a; }

#diario-modal { position: fixed; inset: 0; background: var(--sfondo); z-index: 2000; display: none; flex-direction: column; padding: 40px 25px; overflow-y: auto; }
.scheda-ricordo { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; margin-bottom: 12px; display: flex; align-items: center; gap: 15px; }
</style>
</head>
<body>

<div id="diario-modal">
    <div class="sp-top"><div class="brand">RICORDI</div><button onclick="chiudiDiario()" style="background:var(--rossa); color:white; border:none; padding:10px 20px; border-radius:15px; font-family:'Fredoka One';">CHIUDI</button></div>
    <div id="lista-diario"></div>
</div>

<div id="SPARKPLAY_APP" class="sp-root"></div>

<script>
(()=>{"use strict";

const DB = {
  spazio: [
    {i:"üöÄ", t:"SEGNALE PERDUTO", s:"La base ha perso il segnale! Tutto √® buio!", o:"RIACCENDI L'ANTENNA", p:["Trova un calzino-antenna.","Portalo in un posto alto.","D√¨ 3 Bip lenti."]},
    {i:"üß∏", t:"SATELLITE MORBIDO", s:"Un satellite √® caduto!", o:"RECUPERALO", p:["Trova un peluche-satellite.","Fagli fare un giro completo della stanza.","Riportalo alla base."]}
  ],
  magia: [
    {i:"ü™Ñ", t:"POZIONE INVISIBILE", s:"Dobbiamo preparare una pozione segreta!", o:"MESCOLA GLI INGREDIENTI", p:["Trova un cucchiaio magico.","Trova una tazza vuota.","Gira il cucchiaio 5 volte dicendo 'Abracadabra'."]},
    {i:"‚ú®", t:"INCANTESIMO LENTO", s:"Il tempo si √® fermato!", o:"MUOVITI AL RALLENTATORE", p:["Fai 5 passi lentissimi.","Tocca il naso con un dito, piano piano.","Siediti senza fare rumore."]}
  ],
  detective: [
    {i:"üîç", t:"L'OGGETTO SCOMPARSO", s:"Un indizio √® nascosto nella stanza!", o:"TROVA IL COLORE", p:["Trova qualcosa di colore ROSSO.","Portalo al centro della stanza.","Toccati la testa per confermare."]},
    {i:"üë£", t:"IMPRONTE SEGRETE", s:"Qualcuno √® passato di qui!", o:"SEGUI LE TRACCE", p:["Cammina solo sulle punte dei piedi.","Gira intorno a una sedia 2 volte.","Fai un salto di gioia: caso risolto!"]}
  ]
};

let s = { fsm:"HOME", mondo:null, passo:0, missioneIdx:0, missioneAttuale:null, audio:false, diario: [] };

function parla(testo, alTermine){
  if(!s.audio) { if(alTermine) alTermine(); return; }
  speechSynthesis.cancel();
  const m = new SpeechSynthesisUtterance(testo);
  m.lang="it-IT"; m.rate=0.9;
  if(alTermine) m.onend = alTermine;
  speechSynthesis.speak(m);
}

function disegna(){
  const root = document.getElementById("SPARKPLAY_APP");
  
  if(s.fsm === "HOME"){
    root.innerHTML = `
      <div class="sp-top"><button onclick="apriDiario()" style="background:none;border:none;font-size:30px;">üìö</button><div class="brand">SPARKPLAY</div><button onclick="toggleAudio()" style="background:none;border:none;font-size:30px;">${s.audio?'üîä':'üîà'}</button></div>
      <div class="content-area">
        <div class="multiverso-container"><div class="centro-spark">‚ú®</div><div class="icona-mondo mondo-1">üöÄ</div><div class="icona-mondo mondo-2">ü™Ñ</div><div class="icona-mondo mondo-3">üîç</div></div>
        <h2 style="text-align:center;color:var(--giallo);font-size:36px;margin:0;">PRONTI?</h2>
        <button class="btn-avanti" onclick="vaiMondi()">INIZIA AVVENTURA</button>
      </div>`;
  }

  else if(s.fsm === "SCELTA_MONDO"){
    root.innerHTML = `
      <div class="sp-top"><div class="brand">SCEGLI IL MONDO</div></div>
      <div class="content-area">
        <div class="card-mondo spazio" onclick="scegliMondo('spazio')"><span>üöÄ</span><div><b>SPAZIO</b><br><small>Missioni di movimento</small></div></div>
        <div class="card-mondo magia" onclick="scegliMondo('magia')"><span>ü™Ñ</span><div><b>MAGIA</b><br><small>Missioni creative</small></div></div>
        <div class="card-mondo detective" onclick="scegliMondo('detective')"><span>üîç</span><div><b>DETECTIVE</b><br><small>Missioni di logica</small></div></div>
      </div>`;
  }

  else if(s.fsm === "GIOCO"){
    const m = s.missioneAttuale;
    root.innerHTML = `
      <div class="sp-top"><button onclick="toggleAudio()" style="background:none;border:none;font-size:30px;">${s.audio?'üîä':'üîà'}</button><div class="brand" style="font-size:18px">${m.t}</div><button onclick="home()" style="background:none;color:white;border:none;">ESCI</button></div>
      <div class="content-area">
        <div class="testo-storia">${m.s}</div>
        <div class="obiettivo-box">OBIETTIVO: ${m.o}</div>
        <div class="passaggi">${m.p.map((t,i)=>`<div class="passo ${i===s.passo?'attivo':''}"><b>${i+1}</b> ${t}</div>`).join('')}</div>
        <button class="btn-avanti" onclick="successivo()">${s.passo < m.p.length-1 ? 'AVANTI' : 'COMPLETA ‚úÖ'}</button>
      </div>`;
  }
}

window.vaiMondi = () => { s.fsm = "SCELTA_MONDO"; disegna(); };
window.scegliMondo = (m) => { s.mondo = m; s.missioneIdx = 0; s.fsm = "GIOCO"; s.missioneAttuale = DB[m][0]; s.passo = 0; disegna(); parla(s.missioneAttuale.s + ". Obiettivo: " + s.missioneAttuale.o); };
window.successivo = () => {
  if(s.passo < s.missioneAttuale.p.length - 1){ s.passo++; disegna(); parla(s.missioneAttuale.p[s.passo]); }
  else {
    s.diario.unshift({ titolo: s.missioneAttuale.t, icona: s.missioneAttuale.i, data: new Date().toLocaleDateString('it-IT') });
    localStorage.setItem('sparkplay_diario', JSON.stringify(s.diario));
    alert("Grande! Missione Compiuta!");
    home();
  }
};
window.home = () => { s.fsm = "HOME"; disegna(); };
window.toggleAudio = () => { s.audio = !s.audio; disegna(); };
window.apriDiario = () => {
    const l = document.getElementById("lista-diario");
    l.innerHTML = s.diario.map(m => `<div class="scheda-ricordo"><span>${m.icona}</span><div><b>${m.titolo}</b><br><small>${m.data}</small></div></div>`).join('');
    document.getElementById("diario-modal").style.display = "flex";
};
window.chiudiDiario = () => { document.getElementById("diario-modal").style.display = "none"; };

const salvato = localStorage.getItem('sparkplay_diario');
if(salvato) s.diario = JSON.parse(salvato);
disegna();
})();
</script>
</body>
</html>
