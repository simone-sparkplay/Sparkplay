<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-icon" href="icona.png">
<title>SparkPlay Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --rossa-morbida: #ff5e6c;
  --blu-spaziale: #00d2ff;
  --giallo-stella: #ffe66d;
  --sfondo-profondo: #0a1128;
  --bianco-latte: #f7fff7;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body { 
  margin: 0; background-color: var(--sfondo-profondo); 
  font-family: 'Quicksand', sans-serif; color: var(--bianco-latte); 
  height: 100vh; overflow: hidden;
  background-image: radial-gradient(1px 1px at 25% 15%, white, transparent), radial-gradient(1px 1px at 50% 40%, white, transparent), radial-gradient(2px 2px at 75% 65%, var(--giallo-stella), transparent);
}

.sp-root { max-width: 600px; margin: 0 auto; height: 100vh; display: flex; flex-direction: column; padding: env(safe-area-inset-top) 25px env(safe-area-inset-bottom); }

.sp-top { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
.brand { font-family: 'Fredoka One', cursive; font-size: 32px; color: var(--giallo-stella); text-shadow: 2px 2px var(--rossa-morbida); }

.badge-info { display: flex; gap: 10px; margin-bottom: 10px; justify-content: center; }
.pillola { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 700; border: 1px solid rgba(255,255,255,0.2); }

.content-area { flex: 1; display: flex; flex-direction: column; gap: 20px; justify-content: center; }
.obiettivo-box { background: rgba(0, 210, 255, 0.15); border: 3px dashed var(--blu-spaziale); border-radius: 25px; padding: 18px; text-align: center; font-weight: 700; font-size: 22px; color: var(--blu-spaziale); }

.passo { padding: 18px; border-radius: 30px; background: rgba(255, 255, 255, 0.08); font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
.passo.attivo { background: var(--bianco-latte); color: var(--sfondo-profondo); transform: scale(1.03); box-shadow: 0 10px 30px rgba(255, 230, 109, 0.3); }

.btn { border: none; font-family: 'Fredoka One', cursive; cursor: pointer; transition: 0.2s; box-shadow: 0 6px 0px rgba(0,0,0,0.2); }
.btn:active { transform: translateY(4px); box-shadow: 0 2px 0px rgba(0,0,0,0.2); }
.btn-avvio { background: var(--rossa-morbida); color: white; padding: 15px 40px; border-radius: 30px; font-size: 18px; margin: 0 auto; display: block; }
.btn-pieno { width: 100%; padding: 20px; font-size: 20px; border-radius: 35px; background: var(--rossa-morbida); color: white; }
.btn-indietro { background: #4a5568; color: white; border-radius: 35px; padding: 20px; font-size: 20px; flex: 1; }

.pianeta { font-size: 100px; text-align: center; animation: fluttua 4s infinite ease-in-out; }
@keyframes fluttua { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

/* Modale Diario */
.modale { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
.foglio { background: var(--sfondo-profondo); border: 2px solid var(--line); border-radius: 26px; width: 100%; max-width: 400px; padding: 20px; max-height: 80vh; overflow-y: auto; }
</style>
</head>
<body>

<div id="SPARKPLAY_APP" class="sp-root"></div>

<script>
(()=>{"use strict";

// Collezione di pianeti casuali
const PIANETI = ["ü™ê", "üöÄ", "‚òÑÔ∏è", "üõ∏", "üåç", "üåï", "üåü", "üë®‚ÄçüöÄ"];
const pianetaScelto = PIANETI[Math.floor(Math.random() * PIANETI.length)];

const MISSIONI = [
  {id:"s01", titolo:"SEGNALE PERDUTO", storia:"La base ha perso il segnale! La galassia √® al buio!", obiettivo:"RIACCENDI L'ANTENNA!", passaggi:["Trova un calzino (l'antenna).","Portalo sulla base (tappeto).","D√¨ 3 Bip! lentamente."], finale:"SEGNALE RIPRISTINATO!"}
];

// Stato persistente (Premium)
let dati = JSON.parse(localStorage.getItem('sp_dati')) || { lvl: 1, xp: 0, missioniOggi: 0, diario: [] };
let stato = { schermata:"INIZIO", passo:0, missione:null, audio:false };

function salva() { localStorage.setItem('sp_dati', JSON.stringify(dati)); }

function disegna(){
  const contenitore = document.getElementById("SPARKPLAY_APP");
  
  if(stato.schermata === "INIZIO"){
    contenitore.innerHTML = `
      <div class="sp-top">
        <div class="brand">SPARKPLAY</div>
        <button class="btn" style="background:none; color:white; font-size:24px;" onclick="apriDiario()">üìö</button>
      </div>
      <div class="badge-info">
        <div class="pillola">LIVELLO ${dati.lvl}</div>
        <div class="pillola">OGGI: ${dati.missioniOggi}/3</div>
      </div>
      <div class="content-area">
        <div class="pianeta">${pianetaScelto}</div> <h1 style="font-family:'Fredoka One'; font-size:40px; color:var(--giallo-stella); text-align:center;">PRONTI?</h1>
        <button class="btn btn-avvio" onclick="inizia()">VIA ALLA MISSIONE!</button>
      </div>`;
  } else {
    const m = stato.missione;
    contenitore.innerHTML = `
      <div class="sp-top">
        <button class="btn" onclick="alternaAudio()" style="background:none; font-size:24px;">${stato.audio ? 'üîä' : 'üîà'}</button>
        <div class="brand" style="font-size:20px;">MISSIONE</div>
        <button class="btn" onclick="esci()" style="background:none; color:white; font-size:24px;">‚ùå</button>
      </div>
      <div class="content-area">
        <div style="text-align:center; font-size:20px;">${m.storia}</div>
        <div class="obiettivo-box">${m.obiettivo}</div>
        <div class="passaggi">
          ${m.passaggi.map((testo, i) => `
            <div class="passo ${i === stato.passo ? 'attivo' : (i < stato.passo ? '' : 'sfumato')}">
              <div class="numero">${i + 1}</div> ${testo}
            </div>
          `).join('')}
        </div>
        <div class="controlli">
          <button class="btn btn-indietro" onclick="precedente()" ${stato.passo===0?'style="visibility:hidden"':''}>INDIETRO</button>
          <button class="btn btn-pieno" style="flex:2;" onclick="successivo()">${stato.passo < m.passaggi.length - 1 ? 'AVANTI' : 'FINITO! ‚úÖ'}</button>
        </div>
      </div>`;
  }
}

// Funzioni logica Premium
window.inizia = () => { stato.schermata="GIOCO"; stato.missione=MISSIONI[0]; stato.passo=0; disegna(); };
window.esci = () => { stato.schermata="INIZIO"; disegna(); };
window.successivo = () => {
  if(stato.passo < stato.missione.passaggi.length - 1) {
    stato.passo++; disegna();
  } else {
    dati.xp++; dati.missioniOggi++;
    if(dati.xp >= 3) { dati.lvl++; dati.xp = 0; }
    dati.diario.push({ titolo: stato.missione.titolo, data: new Date().toLocaleDateString() });
    salva(); alert("MISSIONE COMPIUTA! üåü"); esci();
  }
};
window.precedente = () => { if(stato.passo > 0) { stato.passo--; disegna(); } };
window.alternaAudio = () => { stato.audio = !stato.audio; disegna(); };

window.apriDiario = () => {
  const risp = prompt("GENITORE: Quanto fa 12 + 8?");
  if(risp === "20") {
    alert("DIARIO: Hai completato " + dati.diario.length + " missioni in totale!");
  }
};

disegna();
})();
</script>
</body>
</html>
